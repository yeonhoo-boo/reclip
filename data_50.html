# ìš©ëŸ‰ë¬¸ì œë¡œ ì¸í•´ ì˜ìƒ íŒŒì¼ì€ ë”°ë¡œ ì œì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ReClip Log Collector</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  button {
    margin-top: 10px;
    padding: 8px 12px;
    font-size: 14px;
  }
  #captionList {
    margin-top: 15px;
    padding-left: 20px;
  }
</style>
</head>
<body>

<h2>ReClip ì‹œì²­ ë¡œê·¸ ìˆ˜ì§‘ ë°ëª¨</h2>

<video id="video" width="600" controls>
  <source src="" type="video/mp4">
</video>

<br>

<button onclick="addCaption()">ğŸ“ ìº¡ì…˜(ìŠ¤í¬ë©) ì¶”ê°€</button>
<button onclick="downloadXLSX()">ğŸ“Š ë¡œê·¸ XLSX ë‹¤ìš´ë¡œë“œ</button>

<ul id="captionList"></ul>

<script>
const userId = 1;               // ì‚¬ìš©ì ID
const SECTION_LENGTH = 300;     // 5ë¶„ = 300ì´ˆ
let logs = [];
let captionCount = 0;

// í˜„ì¬ êµ¬ê°„ ê³„ì‚°
function getSectionId(time) {
  return Math.floor(time / SECTION_LENGTH);
}

const video = document.getElementById("video");
const captionList = document.getElementById("captionList");

// ì •ì§€
video.addEventListener("pause", () => {
  logs.push({
    user_id: userId,
    section_id: getSectionId(video.currentTime),
    action: "pause",
    value: 1,
    timestamp: video.currentTime
  });
});

video.addEventListener("play", () => {
  logs.push({
    user_id: userId,
    section_id: getSectionId(video.currentTime),
    action: "play",
    value: 1,
    timestamp: video.currentTime
  });
});

// ë˜ê°ê¸°
video.addEventListener("seeked", () => {
  logs.push({
    user_id: userId,
    section_id: getSectionId(video.currentTime),
    action: "rewind",
    value: 1,
    timestamp: video.currentTime
  });
});

// ìº¡ì…˜(ìŠ¤í¬ë©)
function addCaption() {
  const time = video.currentTime;
  const sectionId = getSectionId(time);
  captionCount += 1;

  // ë¡œê·¸ ì €ì¥
  logs.push({
    user_id: userId,
    section_id: sectionId,
    action: "scrap",
    value: 1,
    timestamp: time
  });

  // í™”ë©´ì— ìº¡ì…˜ í‘œì‹œ
  const li = document.createElement("li");
  li.textContent = `ìº¡ì…˜ ${captionCount} - ${Math.floor(time)}ì´ˆ (êµ¬ê°„ ${sectionId})`;
  captionList.appendChild(li);
}

// XLSX ë‹¤ìš´ë¡œë“œ
function downloadXLSX() {
  // logs ë°°ì—´ì„ ì›Œí¬ì‹œíŠ¸ë¡œ ë³€í™˜
  const worksheet = XLSX.utils.json_to_sheet(logs);
  
  // ìƒˆ ì›Œí¬ë¶ ìƒì„±
  const workbook = XLSX.utils.book_new();
  
  // ì›Œí¬ë¶ì— ì›Œí¬ì‹œíŠ¸ ì¶”ê°€
  XLSX.utils.book_append_sheet(workbook, worksheet, "Watch Logs");
  
  // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
  XLSX.writeFile(workbook, "watch_log.xlsx");
}
</script>

</body>
</html>
